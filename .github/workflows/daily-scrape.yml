name: Daily Scrape

on:
  schedule:
    # Run daily at approximately 9:30 AM America/New_York. Because GitHub cron uses UTC and
    # Daylight Saving Time shifts, schedule two UTC times that cover both standard and daylight offsets.
    # - 14:30 UTC is 9:30 EDT (UTC-5)
    # - 13:30 UTC is 9:30 EST (UTC-4)
    - cron: '30 13 * * *'
    - cron: '30 14 * * *'
  workflow_dispatch: {}

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run scraper
        env:
          # Required configuration (set these as repository secrets)
          SCRAPE_URL: ${{ secrets.SCRAPE_URL }}
          CSS_SELECTOR: ${{ secrets.CSS_SELECTOR }}
          MAX_ITEMS: ${{ secrets.MAX_ITEMS }}

          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          EMAIL_FROM: ${{ secrets.EMAIL_FROM }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          EMAIL_SUBJECT_PREFIX: ${{ secrets.EMAIL_SUBJECT_PREFIX }}
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}

          # Optional tuning (with defaults)
          USER_AGENT: ${{ secrets.USER_AGENT || 'NBA-referee-scraper/1.0 (GitHub Actions)' }}
          REQUEST_TIMEOUT: ${{ secrets.REQUEST_TIMEOUT || '15' }}
          LOG_FILE: daily_scraper.log
        run: |
          python ./daily_scraper.py
